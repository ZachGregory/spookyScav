{% extends 'base_generic.html' %}
{% load static %}
{% block page_title %}
    Scav
{% endblock page_title %}

{% block page_style %}
<style>
    body {
        margin: 0;
        background-color: black;
        color: #ffffff;
        font-size: 16px;
    }
    #imgframe {
        font-family: 'Courier New', Courier, monospace;
    }
    #helpButton {
        cursor: pointer;
        position: fixed; 
        top:0; 
        right:0;
        margin:10px; 
        width:3rem; 
        height:3rem;
    }
    #scavHelp {
        position: fixed; 
        top: 0; 
        width: 100%; 
        height: 100%; 
        display: none; 
        margin:0;  
        z-index: 999;
    }
    .slideNumber {
        text-align: center; 
        position:absolute; 
        bottom:0; 
        right:50%;
    }
    .welcomeSlides {
        padding:20px;
        width:80vm;
        height: 80vh;
    }
    #bkgTint {
        background-color:rgba(0,0,0,0.5); 
        position: absolute; 
        width: 100%; 
        height: 100%;
    }
    #helpMenu {
        background-color: #404146; 
        border:solid black; 
        border-radius: 25px; 
        width: 70vmin; 
        height:70vh; 
        margin: auto; 
        position: absolute; 
        top:0; 
        left:50%; 
        transform: translate(-50%, 20%); 
        box-shadow: 0 0 15px 10px #66039b;
    }
    .navButton {
        position:absolute; 
        cursor: pointer; 
        bottom:15px; 
    }
    #scav {
        white-space:nowrap;
    }
    .tree {
        display: inline-block; 
        position:relative;
        margin:100px;
    }
    .branch {
        margin:auto;
        margin-bottom: 32px;
        position: relative;
    }
    .clue {
        margin:auto;
        width:50px; 
        height: 50px;
        border-radius: 20px; 
        display: grid;
    }
    .line {
        margin:auto;
        position:relative;
        display: grid; 
        width:10px; 
        height: 50px;
        background-color: #3f3b49;
    }
    .solved {
        background-color: #51ce6a;
    }
    .solved.line {
        background-color: #51ce6a;
        /*background-color: #54825d;*/
    }
    .solved.clue{
        cursor: pointer;
    }
    .active.line {
        background-color: #3d1758;
        /*background-color: #ab34ff;*/
    }
    .active.clue {
        cursor: pointer;
        background-color: #9c3398;
    }
    .hidden.clue {
        background-color: #5c4c67;
    }
    .blocked {
        background-color: #eb0b0b;
    }
    .fog {
        background: linear-gradient(180deg, rgba(73,73,73,1) 25%, rgba(255,255,255,0) 95%);
    }
    .inline {
        display:inline-grid;
        vertical-align: top;
        position: relative;
    }
    .horizontal {
        display: inline grid;
    }
    .HLine {
        width: 50px;
        height: 10px;
        top:20px;
    }
    .branchTitle {
        width: 0;
        font-size: 16px;
        text-shadow: 0px 0px 4cap rgba(0, 0, 0, 1),
             0px 0px 4px rgba(0, 0, 0, 1),
             0px 0px 2px rgba(0, 0, 0, 1);
    }
    .topText {
        width: 100%;
        height: 150px;
    }
    footer {
        display: none;
    }
</style>
{% endblock page_style %}

{% block js_functions %}
<meta http-equiv="Content-Security-Policy" content="default-src: 'self'" />
{% endblock js_functions %}
{% block body %}
<script>
window.onbeforeunload = function () {
  window.scrollTo(0, 0);
}
var tree = JSON.parse(atob("{{tree|safe}}"));
var old = false;
var toggle = false;
var slideIndex = 1;
//showDivs(slideIndex);

function plusDivs(n) {
    showDivs(slideIndex += n);
}

function showDivs(n) {
    var i;
    var x = document.getElementsByClassName("welcomeSlides");
    if (n > x.length) {slideIndex = 1}
    if (n < 1) {slideIndex = x.length}
    for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";  
    }
    x[slideIndex-1].style.display = "block";
    //Gray out arrows that would go out of slide range
    var x = document.getElementsByClassName("st2");
    if (slideIndex-1 == 0) {
        x[0].style.fill = "rgba(255, 255, 255, 1)";
        x[1].style.fill = "rgba(255, 255, 255, 0.3)";
    } else if (slideIndex-1 == x.length) {
        x[0].style.fill = "rgba(255, 255, 255, 0.3)";
        x[1].style.fill = "rgba(255, 255, 255, 1)";
    } else {
        x[0].style.fill = "rgba(255, 255, 255, 1)";
        x[1].style.fill = "rgba(255, 255, 255, 1)";
    }
}

function toggleHelp() {
    if (/*toggle==*/false){
        document.getElementById("scavHelp").style.display = "block";
        toggle = true;
    } else{
        document.getElementById("scavHelp").style.display = "none";
        toggle = false;
    }
}

function viewSwitch(){
    old = !old;
    var imgframe = document.getElementById("imgframe");
    var scavtext = document.getElementById("scavtext");
    if(old){
        imgframe.style.display = "none";
        scavtext.style.display = "block";
    }else{
        imgframe.style.display = "block";
        scavtext.style.display = "none";
    }
}
</script>
    <div class="topText">
    {% if not team %}
        You are not part of a team
    {% else %}
    <!-- <button onclick="viewSwitch();">Change View</button><br> -->
        Your team:
        {{ team.display_name }}<br>
        Free hints: {{ team.free_hints }}<br>
        {% if bypass %}
            <h1 class="text-red-600 text-xl">Warning: Scav rule bypass is enabled!</h1>
        {% endif %}
        {% if team.scavenger_finished %}
            <h1 class="text-5xl">Congratulation on Completing Scav!</h1>
        {% else %}
            {% if not scavenger_enabled_for_team %}
                Scavenger is not currently enabled
            {% endif %}
    </div>
            <div id="imgframe">
                <!-- Help Button 
                <div onclick="toggleHelp()" id="helpButton">
                    <svg fill="#ffffff" width="3rem" height="3rem" viewBox="0 0 395.001 395">
                        <g><g>
                        <path d="M322.852,0H72.15C32.366,0,0,32.367,0,72.15v250.7C0,362.634,32.367,395,72.15,395h250.701
                            c39.784,0,72.15-32.366,72.15-72.15V72.15C395.002,32.367,362.635,0,322.852,0z M370.002,322.85
                            c0,25.999-21.151,47.15-47.15,47.15H72.15C46.151,370,25,348.849,25,322.85V72.15C25,46.151,46.151,25,72.15,25h250.701
                            c25.999,0,47.15,21.151,47.15,47.15L370.002,322.85L370.002,322.85z"/>
                        <path d="M197.501,79.908c-33.775,0-61.253,27.479-61.253,61.254c0,6.903,5.596,12.5,12.5,12.5c6.904,0,12.5-5.597,12.5-12.5
                            c0-19.99,16.263-36.254,36.253-36.254s36.253,16.264,36.253,36.254c0,11.497-8.314,19.183-22.01,30.474
                            c-12.536,10.334-26.743,22.048-26.743,40.67v40.104c0,6.902,5.597,12.5,12.5,12.5c6.903,0,12.5-5.598,12.5-12.5v-40.104
                            c0-6.832,8.179-13.574,17.646-21.381c13.859-11.426,31.106-25.646,31.106-49.763C258.754,107.386,231.275,79.908,197.501,79.908z"
                            />
                        <path d="M197.501,283.024c-8.842,0-16.034,7.193-16.034,16.035c0,8.84,7.192,16.033,16.034,16.033
                            c8.841,0,16.034-7.193,16.034-16.033C213.535,290.217,206.342,283.024,197.501,283.024z"/>
                        </g></g>
                    </svg>
                </div>-->


                <!-- Help Slides -->
                <div id="scavHelp">
                    <div onclick="toggleHelp()" id="bkgTint"></div>
                    
                    <!-- Overlay -->
                    <div id="helpMenu">
                        <h1 style="text-align: center;">Welcome to SCAV!</h1>
                        <hr>
                        <br>

                        <div class="welcomeSlides">
                            <img src="trade.jpg" style="width: 500;" alt="Map">
                            <p>Hello! Welcome to the EngFrosh scavenger hunt!</p>
                            <p>Anytime there are no major EngFrosh or school related events teams 
                                are able to search all around Ottawa for scav clues.</p>
                            <p>Scav clues look like QR codes with the EngFrosh logo in the middle and are usually taped to a surface. 
                                You may also encounter QR codes from past years (don't mind these, the QR code won't work).</p>
                            <h2 class="slideNumber">1/3</h2>
                        </div>

                        <div class="welcomeSlides">
                            <p>Each scav tree is made from a "Main Branch" and optional side branches. 
                                Depending on the branch, some may be disabled during certain times of the day.
                                Completing side branches may reward your team with free hints, path skips, and more!</p>
                            <p>Most clues are in person and require a photo of a frosh, the QR code, and a facil/head to be uploaded on 
                                the clue submission page. Some clues are online (these will be clearly marked) and only require a code 
                                to be entered in the submission page.</p>
                            <h2 class="slideNumber">2/3</h2>
                        </div>

                        <div class="welcomeSlides">
                            <p>There are also partial clues. These clues require you to find multiple QR codes before moving on. 
                                The clue will indicate how many codes you need to find. </p>
                            <p>Good luck finding all the clues and go get to know Ottawa! If you are stuck you can ask the "spirit on duty" for a hint in your teams Scav channel. </p>
                            <h2 class="slideNumber">3/3</h2>
                        </div>

                        <!-- Nav Buttons -->
                        <div onclick="plusDivs(1)" class="navButton" style="right:15px;">
                            <svg version="1.1" id="icons_1_" width="5rem" height="5rem" viewBox="0 0 128 128" style="enable-background:new 0 0 128 128"><g id="row1_1_"><g id="_x31__3_"><path class="st2" d="M64 0C28.7 0 0 28.7 0 64s28.7 64 64 64 64-28.7 64-64S99.3 0 64 0zm0 121.6C32.2 121.6 6.4 95.8 6.4 64S32.2 6.4 64 6.4s57.6 25.8 57.6 57.6-25.8 57.6-57.6 57.6zM49.2 38.4 73.6 64 49.2 89.6h13.5L86.4 64 62.7 38.4H49.2z" id="_x32__2_"/></g></g></svg>
                        </div>
                        <div onclick="plusDivs(-1)" class="navButton" style="left:15px; transform: rotate(180deg);">
                            <svg version="1.1" id="icons_1_"  width="5rem" height="5rem" viewBox="0 0 128 128" style="enable-background:new 0 0 128 128"><g id="row1_1_"><g id="_x31__3_"><path class="st2" d="M64 0C28.7 0 0 28.7 0 64s28.7 64 64 64 64-28.7 64-64S99.3 0 64 0zm0 121.6C32.2 121.6 6.4 95.8 6.4 64S32.2 6.4 64 6.4s57.6 25.8 57.6 57.6-25.8 57.6-57.6 57.6zM49.2 38.4 73.6 64 49.2 89.6h13.5L86.4 64 62.7 38.4H49.2z" id="_x32__2_"/></g></g></svg>
                        </div>
                    </div>
                </div>

                
                <!-- Actual scav -->
                <div id="scav">
                    <!-- Tree Generation Script -->
                    <script>
                        //Example dictionary - Generated by python and sent here. Python only sends nodes that should be displayed. Only clickable nodes contain links.
                        var tree1Dictionary = { //Use tree1Dictionary["MainBranch"]["clue1"][0] -- to access the status of clue1 in main branch
                            "MainBranch":{ 
                                "clue0":["solved", "start","www.blabla.com"],
                                "clue1":["solved", "", "www.blabla.com"],
                                "clue2":["active", "", "www.blabla.com"],
                                "clue3":["hidden", "", ""],
                                "clue4":["hidden", "", ""],
                                "clue5":["hidden", "", ""],
                                "clue7":["hidden", "", ""],
                                "clue8":["hidden", "", ""]//,
                                //"clue6":["hidden", "end", ""]
                            },
                            "SideBranch1":{ //Branch that ends on the same node it starts and is blocked (by time of day etc)
                                "clueA":["blocked", "clue2", ""],
                                "clueB":["hidden", "", ""],
                                "clueZ":["hidden", "", ""]
                            },
                            "SideBranch2":{ //Branch that goes out of (at clue2)
                                "clueC":["active", "clue1", "https://www.youtube.com/watch?v=dQw4w9WgXcQ"],
                                "clueD":["hidden", "", ""],
                                "clueE":["hidden", "", ""],
                                "clueF":["hidden", "", ""],
                                "clueG":["hidden", "", ""],
                                "clueH":["hidden", "", ""]
                            },
                            "SideBranch3":{ //Branch that does not end but the rest of the branch is not shown. This is hidden and so there is no link
                                "clueI":["hidden", "clue3", ""],
                                "clueJ":["hidden", "", ""],
                                "clueK":["hidden", "", ""]
                            },
                            "SideBranch4":{ //Branch that does not end but the rest of the branch is not shown. This is hidden and so there is no link
                                "clueL":["hidden", "clue5", ""],
                                "clueM":["hidden", "", ""]
                            },
                            "SideBranch5":{ //Branch that does not end but the rest of the branch is not shown. This is hidden and so there is no link
                                "clueN":["hidden", "clue5", ""],
                                "clueO":["hidden", "", ""]
                            }
                        }

                        //Function to sort the tree
                        function compareFn(a, b) {
                            let aKeys = Object.keys(tree[a]);
                            let bKeys = Object.keys(tree[b])
                            if (tree[a][aKeys[0]][1] == "start"){
                                return -1;
                            }else if (tree[b][bKeys[0]][1] == "start") {
                                return 1;
                            }else if (Number(tree[a][aKeys[0]][1]) == NaN || Number(tree[b][bKeys[0]][1]) == NaN){
                                if (Number(tree[a][aKeys[0]][1]) == NaN){
                                    return 1;
                                }else {
                                    return -1;
                                }
                            }else if (Number(tree[a][aKeys[0]][1]) < Number(tree[b][bKeys[0]][1])) {
                                return -1;
                            } else if (Number(tree[a][aKeys[0]][1]) > Number(tree[b][bKeys[0]][1])) {
                                return 1;
                            }
                            // a must be equal to b
                            return 0;
                        }
                        
                        
                        tree = Object.keys(tree).sort(compareFn).reduce((r, k) => (r[k] = tree[k], r), {})
                        generateScavTree(tree);

                        function generateScavTree(tree) {
                            let branchIndex = 0;
                            let clueIndex = 0;
                            let leftClues = 0;
                            let rightClues = 0;
                            const treeId = Math.random().toString(36).substring(2, 10);
                            let curBranchSide, curBranch;
                            const totalBranches = Object.keys(tree).length;
                            const leftBranches = Math.ceil((totalBranches - 1) / 2);
                            const rightBranches = Math.floor((totalBranches - 1) / 2);

                            // Tree container
                            document.write("<div class='tree'>");

                            // Create left, middle, and right sections
                            document.write(`<div id='${treeId}LeftSide' class='inline'></div>`);
                            document.write(`<div id='${treeId}Middle' class='inline'></div>`);
                            document.write(`<div id='${treeId}RightSide' class='inline'></div>`);

                            for (const branch in tree) { // Iterate through each branch
                                clueIndex = 0;
                                branchIndex += 1;
                                let isMain = false;
                                let keys = Object.keys(tree[branch]);
                                if (keys.length > 0 && tree[branch][keys[0]][1] == "start"){
                                    isMain = true;
                                }

                                // Determine the current branch side (left, middle, right)
                                if (isMain) {
                                    curBranchSide = document.getElementById(`${treeId}Middle`);
                                } else if ((branchIndex % 2 === 0 && branch != "SIDE-QUEST")) {
                                    curBranchSide = document.getElementById(`${treeId}LeftSide`);
                                } else {
                                    curBranchSide = document.getElementById(`${treeId}RightSide`);
                                }

                                // Create branch container
                                curBranchSide.innerHTML += `<div id='${treeId}${branch}' class='branch ${branch}'>
                                                            <div class='branchTitle'>${branch.replace(/([A-Z])/g, ' $1').trim()}</div>
                                                            <div id='horz${treeId}${branch}' class='horz'></div>
                                                            <div id='vert${treeId}${branch}' class='vert'></div>
                                                            </div>`;
                                curBranch = document.getElementById(`${treeId}${branch}`);

                                // Adjust styling based on the side
                                if (curBranchSide.id === `${treeId}LeftSide`) {
                                    curBranchSide.style.width = (leftBranches * 100) + 'px';
                                    curBranch.style.marginRight = 0;
                                    document.getElementById(`vert${treeId}${branch}`).style.float = 'left';
                                } else if (curBranchSide.id === `${treeId}RightSide`) {
                                    curBranchSide.style.width = (rightBranches * 100) + 'px';
                                    document.getElementById(`vert${treeId}${branch}`).style.float = 'right';
                                    curBranch.style.marginLeft = 0;
                                }

                                const horzContainer = document.getElementById(`horz${treeId}${branch}`);
                                const vertContainer = document.getElementById(`vert${treeId}${branch}`);
                                const maxHorzClues = isMain ? 0 : Math.ceil((totalBranches - branchIndex + 1) / 2);

                                for (const clue in tree[branch]) { // Iterate through each clue
                                    clueIndex += 1;

                                    // Create clue element based on its status
                                    const clueStatus = tree[branch][clue][0];
                                    let clueClass = '';
                                    let clueIcon = '';

                                    //Moves the branches to their correct positions based on id of desired main branch clue
                                    if (clueIndex == 1){
                                        if (curBranchSide.id == `${treeId}LeftSide`){
                                            curBranch.style.position = 'absolute';
                                            let topOffset = document.getElementById(`${tree[branch][clue][1]}`).getBoundingClientRect().y - 288;
                                            let leftWidth = maxHorzClues*100;
                                            curBranch.style.top = `${topOffset}px`;
                                            curBranch.style.width = `${leftWidth}px`;
                                            curBranch.style.right = `0px`;
                                            if (branch == "SIDE-QUEST"){
                                                let rightOffset = document.getElementById(`${tree[branch][clue][1]}`).getBoundingClientRect().x;
                                                curBranch.style.right = `${rightOffset-615}px`;
                                            }
                                        } else if (curBranchSide.id === `${treeId}RightSide`){
                                            curBranch.style.position = 'absolute';
                                            let topOffset = document.getElementById(`${tree[branch][clue][1]}`).getBoundingClientRect().y - 288;
                                            curBranch.style.top = `${topOffset}px`;
                                            if (branch == "SIDE-QUEST"){
                                                let leftOffset = document.getElementById(`${tree[branch][clue][1]}`).getBoundingClientRect().x;
                                                curBranch.style.left = `${leftOffset-615}px`;
                                            }
                                        }
                                    }

                                    if (clueStatus === "solved") {
                                        clueClass = 'solved';
                                        //clueIcon = "<svg width='40px' height='40px' fill='#ffffff' viewBox='0 0 955.706 955.706' style='margin:auto;'><g><path  stroke-width='10'  d='M130.779,710.205c20.095,44.904,48.277,84.92,83.824,119.039l-6.645,126.461l107.664-56.791c50.886,24.09,105.421,36.297,162.23,36.297c57.085,0,111.851-12.314,162.927-36.623l108.284,57.117l-6.709-127.676c35.186-34.084,63.07-73.969,82.94-118.654c21.637-48.66,32.607-100.547,32.607-154.213c0-64.281-16.069-126.843-46.684-182.616h35.726V268.182H712.462l130.93-127.667c16.385-15.98,16.718-42.31,0.741-58.695l-0.124-0.127c-7.771-7.97-18.604-12.537-29.728-12.537c-10.89,0-21.181,4.187-28.978,11.789L593.281,268.182H409.543c0.402-3.208,0.635-6.47,0.635-9.787c0-43.055-35.028-78.082-78.082-78.082c-43.054,0-78.082,35.027-78.082,78.082c0,3.317,0.232,6.579,0.635,9.787H110.076v104.364h34.411c-30.614,55.773-46.684,118.335-46.684,182.616C97.803,609.145,108.898,661.309,130.779,710.205z M807.803,104.017c1.805-1.76,4.143-2.636,6.479-2.636c2.415,0,4.828,0.937,6.646,2.802l0.131,0.134c3.579,3.671,3.505,9.546-0.165,13.126L666.301,268.182h-26.859L807.803,104.017z M332.096,212.538c25.285,0,45.856,20.571,45.856,45.856c0,3.359-0.373,6.632-1.062,9.787h-89.589c-0.689-3.155-1.062-6.428-1.062-9.787C286.24,233.11,306.811,212.538,332.096,212.538z M142.302,340.321v-39.912h124.03h20.224h27.19h36.699h27.191h20.223h162.372h46.16h26.86h46.159h135.307v39.912h-23.206H638.479h-46.161h-26.858h-46.161H164.192H142.302z M553.045,487.488H487.55h-46.16h-26.859h-11.873h-32.226v25.445c-7.507-1.773-14.883-3.74-22.118-5.889c-28.513-8.469-54.793-19.791-77.833-33.746c-46.072-27.903-74.017-63.2-80.252-100.753h296.02h46.16h26.859h46.16h160.045c-6.236,37.553-34.18,72.85-80.253,100.753c-28.886,17.494-62.857,30.863-99.951,39.634v-25.445H553.045z M553.045,519.715v32.133v10.834h-142.61h-7.777v-10.834v-26.592v-5.541h2.836h2.848h46.16h95.708H553.045L553.045,519.715z M165.08,402.835c13.754,37.181,44.079,70.999,88.708,98.028c20.697,12.535,43.704,23.131,68.421,31.637c11.461,3.941,23.293,7.434,35.429,10.463c4.229,1.057,8.493,2.057,12.794,2.998v10.717v6.004v32.227h6.953h25.271h150.388h32.226v-32.227v-16.721c43.268-9.48,83.007-24.727,116.646-45.096c44.629-27.031,74.954-60.85,88.708-98.03c23.021,47.191,35.051,99.11,35.051,152.327c0,49.127-10.036,96.605-29.828,141.119c-19.123,43.006-46.361,81.156-80.958,113.395l-5.501,5.125l4.515,85.924l-72.67-38.332l-7.414,3.729c-48.671,24.461-101.145,36.865-155.966,36.865c-54.564,0-106.821-12.297-155.318-36.545l-7.402-3.701l-72.014,37.984l4.456-84.801l-5.559-5.131c-34.953-32.266-62.481-70.535-81.82-113.75c-20.016-44.73-30.165-92.467-30.165-141.881C130.029,501.945,142.058,450.028,165.08,402.835z'/><path d='M445.293,202.762c32.393,0,58.746-26.354,58.746-58.747s-26.354-58.747-58.746-58.747c-32.394,0-58.747,26.354-58.747,58.747S412.9,202.762,445.293,202.762z M445.293,117.494c14.624,0,26.521,11.897,26.521,26.521s-11.896,26.521-26.521,26.521s-26.521-11.897-26.521-26.521S430.669,117.494,445.293,117.494z'/><path d='M348.209,58.746C348.209,26.352,321.856,0,289.463,0s-58.747,26.353-58.747,58.746s26.354,58.747,58.747,58.747C321.855,117.494,348.209,91.14,348.209,58.746z M262.941,58.746c0-14.624,11.897-26.521,26.521-26.521c14.625,0,26.521,11.896,26.521,26.521s-11.896,26.521-26.521,26.521C274.838,85.267,262.941,73.371,262.941,58.746z'/></g></svg>";
                                        clueIcon = "<img src='/static/pumpGreen.png'  style='margin:auto; height:50px; width:50px; border-radius:20px;'>";
                                    } else if (clueStatus === "active") {
                                        clueClass = 'active';
                                        //clueIcon = "<svg width='32px' height='32px' fill='#ffffff' viewBox='0 0 512 512' style='margin:auto;'><path fill='#ffffff' d='M133.28 18.22c-21.24.154-43.79 7.987-63.56 23.03-2.745-1.017-5.597-1.656-8.47-1.906-10.406-.905-21.097 3.164-28.125 11.812-8.964 11.03-9.41 26.375-2.22 37.844-19.66 41.305-13.464 86.867 16.157 110.938 22.238 18.072 52.514 20.727 82.376 9.187l5.03-1.938 4.22 3.407 46.562 37.812L201.844 228l-43.875-35.656 11.78-14.5 43.875 35.625 15.344-18.876-43.876-35.656 11.78-14.5 43.876 35.656 16.563-20.375-46.532-37.814-4.218-3.437.875-5.345c5.19-31.587-3.573-60.646-25.812-78.72-13.53-10.994-30.48-16.316-48.344-16.186zm-2.25 25.468l43.845 13.874L139.562 101l-24.25-7.656 15.72-49.656zM57.876 57.78c.548-.016 1.107.013 1.656.064 2.637.243 5.25 1.265 7.5 3.093 6 4.876 6.876 13.408 2 19.407-4.874 5.998-13.406 6.907-19.405 2.03-6-4.875-6.876-13.406-2-19.405 2.666-3.282 6.41-5.068 10.25-5.19zm56.906 59.75l55.376 11.564-32.72 40.25-22.655-51.813zM91.22 123l12.468 22.156-35.313 43.438-22.53-40.063L91.218 123zm155.03 80l-21.97 27.03 125.157 101.69-24.593 30.25 17.562 14.28 19.875-24.47 14.5 11.783-19.874 24.468 13.25 10.783-16.687 20.53-38.126 44.47 14.187 12.156 32.595-38 19.25 8.03 22.906-28.188 14.5 11.782-41.092 50.562 18.187 14.78 61.406-75.56 15.44 12.562 21.967-27.032L246.25 203z'/></svg>";
                                        clueIcon = "<img src='/static/pumpDark.png'  style='margin:auto; height:50px; width:50px; border-radius:20px;'>";
                                    } else if (clueStatus === "blocked") {
                                        clueClass = 'blocked';
                                        clueIcon = "<svg fill='#FFFFFF' width='32px' height='32px' viewBox='0 0 28.25 28.25' style='margin:auto;'><g><path d='M14.125,0C6.337,0,0,6.337,0,14.125S6.337,28.25,14.125,28.25S28.25,21.913,28.25,14.125S21.913,0,14.125,0z M4,14.125C4,8.542,8.542,4,14.125,4c2.251,0,4.325,0.747,6.009,1.994L5.993,20.134C4.747,18.45,4,16.376,4,14.125z M14.125,24.25c-2.251,0-4.326-0.748-6.011-1.995l14.141-14.14c1.247,1.684,1.995,3.759,1.995,6.01C24.25,19.708,19.708,24.25,14.125,24.25z'/></g></svg>";
                                    } else if (clueStatus === "hidden") {
                                        clueClass = 'hidden';
                                    }

                                    const clueElement = `<div id='line${branch}${clueIndex}' class='line ${clueClass}'></div>
                                                        <div id='${clue}' class='clue ${clueClass}' onclick="window.location='puzzle/${tree[branch][clue][2]}/{{ params }}';">${clueIcon}</div>`;

                                    if (isMain || clueIndex > maxHorzClues) {
                                        vertContainer.innerHTML += clueElement;
                                        if (curBranchSide.id === `${treeId}LeftSide`){ //Adds to the vertical clue count
                                            leftClues += 1;
                                        } else if (curBranchSide.id === `${treeId}RightSide`){
                                            rightClues += 1;
                                        }
                                    } else {
                                        horzContainer.innerHTML += clueElement;
                                    }

                                    // Add horizontal classes if needed
                                    if (!isMain && clueIndex <= maxHorzClues) {
                                        const myLine = document.getElementById(`line${branch}${clueIndex}`);
                                        const myClue = document.getElementById(`${clue}`);
                                        const floatDirection = curBranchSide.id === `${treeId}LeftSide` ? 'right' : 'left';
                                        myLine.style.float = floatDirection;
                                        myClue.style.float = floatDirection;
                                        myLine.classList.add('horizontal', 'HLine');
                                        myClue.classList.add('horizontal');
                                    }

                                    // Remove the first line of the main branch
                                    if (isMain && clueIndex === 1) {
                                        document.getElementById(`line${branch}${clueIndex}`).remove();
                                    }

                                    // Add fog line if it's the last visible clue in the main branch
                                    if (isMain && tree[branch][clue][1] == "end" && tree[branch][clue][0] != "solved") {
                                        const length = Object.keys(tree[branch]).length;
                                        if (length === clueIndex) {
                                            curBranch.innerHTML += `<div id='line${branch}${clueIndex + 1}' class='line fog'></div>`;
                                        }
                                    }
                                }
                            }
                            document.write('</div>'); // Close tree container
                        }
                    </script>
                </div>
            </div>
            </div>

            <div id="scavtext" style="display: none;">
                <h2 style="font-size: 20px;">Active Scavenger Puzzles</h2>
                <ul>
                    {% for puzzle in active_puzzles %}
                        <a href="{% url 'view_puzzle' slug=puzzle.secret_id%}">{{puzzle.name}}</a><br>
                    {% endfor %}
                </ul><br>
                <h2 style="font-size: 20px;">Puzzles Missing Image</h2>
                <ul>
                    {% for puzzle in completed_puzzles_requiring_photo_upload %}
                        <a href="{% url 'verify_puzzle' slug=puzzle.secret_id%}">{{puzzle.name}}</a><br>
                    {% endfor %}
                </ul><br>
                <h2 style="font-size: 20px;">Puzzles Awaiting Verification</h2>
                <ul>
                    {% for puzzle in completed_puzzles_awaiting_verification %}
                        <a href="{% url 'view_puzzle' slug=puzzle.secret_id%}">{{puzzle.name}}</a><br>
                    {% endfor %}
                </ul><br>
                <h2 style="font-size: 20px;">Verified Scavenger Puzzles</h2>
                <ul>
                    {% for puzzle in verified_puzzles %}
                        <a href="{% url 'view_puzzle' slug=puzzle.secret_id%}">{{puzzle.name}}</a><br>
                    {% endfor %}
                </ul>
            </div>
            <script>
                showDivs(slideIndex);
            </script>
        {% endif %}
    {% endif %}
{% endblock body %}
